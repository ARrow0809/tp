# APIキー管理の安全性向上について

## 実装した改善点

1. **APIキー管理専用コンポーネント**
   - `ApiKeyManager`と`ApiKeyModal`コンポーネントを作成
   - 専用のUIで複数のAPIプロバイダー（Gemini、OpenAI、その他）のキーを管理可能

2. **キーの暗号化保存**
   - 単純なBase64エンコードではなく、XOR暗号化とBase64エンコードの組み合わせを使用
   - `utils/encryption.ts`に暗号化・復号化関数を実装
   - ブラウザのデベロッパーツールから直接キーが読み取られるリスクを軽減

3. **UIの改善**
   - パスワードフィールドを使用し、キーが画面上に表示されないよう配慮
   - 表示/非表示切り替えボタンを追加し、必要時のみキーを確認可能
   - キーの保存・クリア時に確認メッセージを表示

4. **APIキー設定へのアクセス性向上**
   - APIキーが未設定の場合は警告メッセージと共に設定ボタンを表示
   - APIキーが設定済みの場合も、ヘッダー部分に設定ボタンを表示

## セキュリティ上の注意点

1. **クライアントサイド暗号化の限界**
   - 実装した暗号化はあくまで「難読化」であり、完全な安全性は保証されない
   - 暗号化キー自体がクライアントコードに含まれるため、決定的な保護にはならない

2. **XSS攻撃のリスク**
   - クロスサイトスクリプティング攻撃に対して脆弱性が残る
   - 悪意のあるスクリプトがlocalStorageにアクセスする可能性がある

3. **理想的なアプローチ**
   - 本来はバックエンドサーバーでAPIキーを管理し、クライアントには公開しない
   - ユーザー認証と組み合わせ、サーバーサイドでAPIリクエストを中継する

## 今後の改善案

1. **セッションストレージの活用**
   - ブラウザを閉じると消去されるセッションストレージの利用
   - 長期保存が必要な場合のみユーザーの明示的な選択を求める

2. **キー有効期限の設定**
   - 保存されたAPIキーに有効期限を設け、定期的に再入力を求める

3. **バックエンドサービスの導入**
   - 将来的には、安全なバックエンドサービスを導入し、APIキーをサーバー側で管理
   - クライアントはユーザー認証トークンのみを保持し、APIキーは直接扱わない

4. **環境変数との統合改善**
   - 現在のグローバル変数への代入ではなく、より適切なAPIキー適用方法の実装
   - 各APIクライアントライブラリを適切にラップし、動的にキーを設定できるようにする